!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():t.wechatPreview=e()}(this,function(){"use strict";function t(t,e){var i,r={};for(i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=t[i]);for(i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i]);return r}function e(t){var e=t.toLowerCase().replace(/ /g,"");return e}function i(t,e){return t.classList?t.classList.contains(e):new RegExp("(^| )"+e+"( |$)","gi").test(t.className)}function r(t,e){t.classList?t.classList.add(e):t.className+=" "+e}function a(t,e){t.classList?t.classList.remove(e):t.className=t.className.replace(new RegExp("(^|\\b)"+e.split(" ").join("|")+"(\\b|$)","gi")," ")}function s(t){return t?t=t.replace(/(\w+)([\w\s#!:,.?+=&%@!\-\/]+)?/g,function(t){return'<span class="wcp-en">'+t+"</span>"}):void 0}function l(t,e,i){return t=document.createElement(t),e&&(t.className=e),i&&i.appendChild(t),t}function c(i){if(!(this instanceof c))throw new TypeError("wechatPreview constructor cannot be called as a function.");if(i=t({container:!1},i),i.container?(this.el=l("div","wcp"),this.main=l("div","wcp-main",this.el),this.postWrapper=l("div","wcp-post-wrapper wcp-empty",this.main),this.timestamp=l("div","wcp-timestamp",this.postWrapper)):i.container||(this.el=l("div"),this.postWrapper=l("div",!1,this.el)),this.contentWrapper=l("div","wcp-content-wrapper",this.postWrapper),i.container||r(this.contentWrapper,"wcp-gallery"),"object"==typeof i.container&&i.container.width&&i.container.height)"number"==typeof i.container.width&&"number"==typeof i.container.height&&(i.container.width=i.container.width+"px",i.container.minHeight=i.container.height+"px"),this.el.style.width=i.container.width,this.el.style.height=i.container.height;else if("string"==typeof i.container)for(var a in n)n.hasOwnProperty(a)&&a==e(i.container)&&(this.el.style.width=n[a].width,this.el.style.height=n[a].height);else if("boolean"!=typeof i.container)throw new TypeError("Container object contains invalid values")}var n={iphone4:{height:"480px",width:"320px"},iphone5:{height:"568px",width:"320px"},iphone6:{height:"667px",width:"375px"},iphone6plus:{height:"736px",width:"414px"}};return c.prototype.article=function(t,e,i){this.previous?this.previous&&!this.previous.articles[e]&&(this.articles[e]=l("div","wcp-article",i)):this.articles[e]=l("div","wcp-article",i);var c=this.articles[e];if(c&&!c.articleTitleEl&&(c.articleTitleEl=l("div","wcp-article-title",c)),c&&!c.articleTitle&&(c.articleTitle=l("p",!1,c.articleTitleEl)),c&&!c.articleDateEl&&(c.articleDateEl=l("span","wcp-article-date",c)),c&&!c.articleImageEl&&(c.articleImageEl=l("div","wcp-article-image",c)),c&&!c.articleDescriptionEl&&(c.articleDescriptionEl=l("div","wcp-article-description",c)),c&&!c.readAllEl&&(c.readAllEl=l("div","wcp-read-all",c)),c&&!c.readAll&&(c.readAll=l("span",!1,c.readAllEl)),t.shadow?(this.shadowContent||(this.shadowContent=l("div","wcp-shadow-content",c)),this.shadowContent&&this.shadowContent.parentNode!=c&&c.appendChild(this.shadowContent),r(c,"wcp-shadow")):c&&!t.shadow&&a(c,"wcp-shadow"),t&&c)c.articleTitle.innerHTML=s(t.title),c.articleDateEl.innerHTML=this.articleDate,!c.articleImage&&t.image&&(c.articleImage=l("img",!1,c.articleImageEl)),t.image?(c.articleImage.setAttribute("src",t.image),c.articleImage.onload=function(){c.articleImage.width/c.articleImage.height<1.8?c.articleImage.style.width="100%":c.articleImage.width>c.articleImage.height&&(c.articleImage.style.height="100%")}):c.articleImageEl.classList.add("wcp-null-image"),c.articleDescriptionEl.innerHTML=t.description,c.readAll.innerHTML="阅读原文";else if(!t){c.articleTitle&&(c.articleTitle.innerHTML=""),c.articleDateEl&&(c.articleDateEl.innerHTML=""),c.articleImage&&c.articleImage.removeAttribute("src"),c.articleDescriptionEl&&(c.articleDescriptionEl.innerHTML=""),c.readAll&&(c.readAll.innerHTML="");for(var n=0;3>n;n++)l("div","wcp-text-line",c.articleDescriptionEl)}return c},c.prototype.generate=function(e){var s={postTime:new Date,articles:[]};if(e=t(s,e),e.articles)for(var l=0;l<e.articles.length;l++)this.previous?this.previous&&(this.previous.articles[l]&&(e.articles[l]=t({title:this.previous.articles[l].title,description:this.previous.articles[l].description,image:this.previous.articles[l].image,shadow:!1},e.articles[l])),e=t(this.previous,e)):e.articles[l]=t({title:"微博正文",description:"摘要",image:null,shadow:!1},e.articles[l]);if(this.articles||(this.articles=[]),e.postTime){var c=["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],n=["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],p=new Date(e.postTime),o=p.getDate(),h=new Date,d=h.getDate(),w=p.getDay(),g=h.getDay(),m=o+"日",u=d-o,v=c[w],f=p.getMonth(),y=h.getMonth(),E=n[f],D=p.getFullYear(),T=("0"+p.getHours()).slice(-2),W=("0"+p.getMinutes()).slice(-2),L=T+":"+W;this.postDate=d==o&&f==y?L:w==g-1&&7>u?"昨天 "+L:7>u&&u>0?v+" "+L:D+"年"+E+m+" "+L,this.articleDate||(this.articleDate=E+m),this.timestamp&&(this.timestamp.innerHTML=this.postDate)}if(e.articles&&0!=e.articles.length||(r(this.postWrapper,"wcp-empty"),this.articles[0]&&this.contentWrapper.removeChild(this.articles[0]),this.articles[0]=this.article(!1,0,!1),this.articles[0].parentNode!=this.contentWrapper&&this.contentWrapper.appendChild(this.articles[0]),r(this.articles[0],"wcp-single"),this.timestamp&&(this.timestamp.innerHTML="")),e.articles&&e.articles.length>0){if(this.articles[0]&&i(this.postWrapper,"wcp-empty")&&this.contentWrapper.removeChild(this.articles[0]),a(this.postWrapper,"wcp-empty"),this.previous)for(var I=0;I<this.previous.articles.length;I++)I>=e.articles.length&&this.contentWrapper.removeChild(this.articles[I]);e.articles.length>1&&a(this.contentWrapper,"wcp-gallery");for(var l=0;l<e.articles.length&&9>l;l++)this.articles[l]=this.article(e.articles[l],l,this.contentWrapper),this.articles[l]&&this.articles[l].parentNode!=this.contentWrapper&&this.contentWrapper.appendChild(this.articles[l]),0==l&&e.articles.length>1?(a(this.articles[0],"wcp-single"),r(this.articles[0],"wcp-top")):1==e.articles.length||i(this.contentWrapper,"wcp-gallery")?(a(this.articles[0],"wcp-top"),r(this.articles[0],"wcp-single")):r(this.articles[l],"wcp-normal");this.previous=e}},c});